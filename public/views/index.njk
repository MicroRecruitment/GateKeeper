{% extends './layout.njk' %}

{% block content %}
<div class="form">
    <form id="login" class="loginForm" method="POST" action="">
        <input type="text"      name="username" placeholder="Username"/>
        <input type="password"  name="password" placeholder="Password"/>
        <input type="submit" value="LOGIN" />
        <p class="message">Not registered? <a href="register">Create an account</a></p>
    </form>
</div>
<script>
    var socket = io();

    $('form#login').on('submit', function (evt) {
        evt.preventDefault();
        console.log('Websocket -> Gateway (Login)');

        let formData = new FormData(document.getElementById("login"));
        var object = {};
        formData.forEach((value, key) => {
            object[key] = value
        });
        //console.log(object);

        /*
        let stringFormData = $(this).serialize() ;
        console.log(stringFormData);

        $.post($(this).attr("action"), stringFormData, (data) => {
            console.log("Login success: " + data);
        }).done((data) => {
            console.log("Login success: " + data);
        }).fail((data) => {
            console.log("Login failed:");
            console.log(data);
        })
        */

        socket.emit('AUTH::LOGIN', object, function (reply) {
            console.log(reply);
            if (reply.status) {
                window.location = '/home';
            }
        });

        return false;
    });
</script>
{% endblock %}
